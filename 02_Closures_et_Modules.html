
<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Closures</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="reveal.js/css/reveal.css">
    <link rel="stylesheet" href="reveal.js/css/theme/black.css" id="theme">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
        <section>
          <h1>Closures (Fermetures)</h1>
          <p>
            <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Closures">
              https://developer.mozilla.org/fr/docs/Web/JavaScript/Closures
            </a>
          </p>
        </section>

        <section>
          <h2>Scope (portée lexicale)</h2>
          <p>
            Les variables définies dans une fonction sont visibles par ses sous-fonctions.
          </p>
          <pre><code class="hljs" data-trim>
function compteur() {
  var cpt = 0;
  function increment() {
    cpt += 1; // cpt est visible car défini dans le scope parent
    console.log(cpt);
  }
};
          </code></pre>
        </section>

        <section>
          <h2>Closure - 1</h2>
          <pre><code class="hljs" data-trim>
function compteur() {
  var cpt = 0;
  function increment() {
    cpt += 1;
    console.log(cpt);
  }
  increment();
};

compteur(); // ???
compteur(); // ???
          </code></pre>
        </section>

        <section>
          <h2>Closure - 2</h2>
          <pre><code class="hljs" data-trim>
function compteur() {
  var cpt = 0;
  return function() {
    cpt += 1;
    console.log(cpt);
  }
};

var cpt = compteur();
cpt(); // ???
cpt(); // ???
          </code></pre>
        </section>

        <section>
          <h2>Closure - 3</h2>
          <p>
            Une closure combine 2 éléments :
            <ul>
              <li>une fonction</li>
              <li>l'environnement dans lequelle elle a été créée</li>
            </ul>
          </p>
        </section>

        <section>
          <h2>Autre exemple de closure</h2>
          <pre><code class="hljs" data-trim>
function faireAddition(x) {
  return function(y) {
    return x + y;
  };
};

var ajout5 = faireAddition(5);
var ajout10 = faireAddition(10);

console.log(ajout5(2));  // 7
console.log(ajout10(2)); // 12
          </code></pre>
        </section>

        <section>
          <h2>Le pattern module</h2>
          <p>
            Ce pattern est utilisé pour encapsuler du code tout en permettant un accès exterieur à certaines propriétés et fonctions.
          </p>
          <p>
            Il est aussi utilisé pour limiter le nombre de variables globales.
          </p>
        </section>

        <section>
          <h2>Exemple</h2>
          <pre><code class="hljs" data-trim>
var MODULE = (function() {
    var variablePrivee = 10;
    function methodePrivee() {
        console.log('privé');
    }
    return {
      attributPublic: "abc",
      methodePublique: function() {
        console.log('publique');
      };
    };
})();
console.log(MODULE.attributPublic);
console.log(MODULE.methodePublique());
          </code></pre>
          <p>
            Ici, seule la variable MODULE est exposée dans le scope global.
          </p>
        </section>

        <section>
          <h2>Exercice</h2>
          <p>
            Développer une version nodejs du jeux "c'est plus c'est moins", en complétant le code suivant.
          </p>
          <pre><code class="hljs" data-trim>
var readline = require('readline');

// Module
var PlusOuMoins = (function() {
  var valeur = Math.floor(Math.random() * 100) + 1;
  ...
})();

// Prompt
var rl = readline.createInterface(process.stdin, process.stdout);
rl.setPrompt('Quel est le nombre ? ');
rl.prompt();
rl.on('line', function(n) {
    // rl.close(); // ferme l'invite de commande
    // rl.prompt(); // demande à l'utilisateur de saisir une valeur
    ...
}).on('close',function() {
    process.exit(0);
});
          </code></pre>
        </section>

      </div>

    </div>

    <script src="reveal.js/lib/js/head.min.js"></script>
    <script src="reveal.js/js/reveal.js"></script>

    <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,
        lideNumber: true,
        slideNumber: 'c/t',

        transition: 'slide', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
          { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
          { src: 'reveal.js/plugin/notes/notes.js', async: true }
        ]
      });

    </script>

  </body>
</html>
